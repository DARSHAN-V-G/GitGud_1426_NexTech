<!DOCTYPE html>
<html lang="en">
<style>
    /* styles.css */

body {
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;
}

h1 {
  color: #333;
  text-align: center;
  padding: 20px;
}

form {
  max-width: 400px;
  margin: 0 auto;
  padding: 20px;
  background-color: #fff;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
}

label {
  display: block;
  margin-bottom: 8px;
  color: #333;
}

select,
input,
textarea {
  width: calc(100% - 22px); /* Adjusted width to account for padding and borders */
  padding: 10px;
  margin-bottom: 10px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  background-color: #4caf50;
  color: #fff;
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
}

button:hover {
  background-color: #45a049;
}

</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Booking</title>
</head>
<body>
    <h1>Room Booking System</h1>
    <form id="bookingForm">
        <label for="floor">Choose a floor:</label>
        <select id="floor" name="floor">
            {% for floor in floors %}
                <option value="{{ floor }}">Floor {{ floor }}</option>
            {% endfor %}
        </select>
        <label for="room">Choose a room:</label>
        <select id="room" name="room">
            <!-- Options will be filled dynamically using JavaScript -->
        </select>
        <label for="time_from">Choose a time from:</label>
        <input type="time" id="time_from" name="time_from">
        <label for="time_to">Choose a time to:</label>
        <input type="time" id="time_to" name="time_to">
        <button type="button" id="checkAvailability">Check Availability</button>
        <button type="button" id="bookRoom">Book Room</button>
        <p id="statusMessage"></p>
    </form>

    <script>document.addEventListener("DOMContentLoaded", function () {
        const floorSelect = document.getElementById("floor");
        const roomSelect = document.getElementById("room");
        const timeFromInput = document.getElementById("time_from");
        const timeToInput = document.getElementById("time_to");
        const checkAvailabilityBtn = document.getElementById("checkAvailability");
        const bookRoomBtn = document.getElementById("bookRoom");
        const statusMessage = document.getElementById("statusMessage");
    
        // Populate room options based on selected floor
        floorSelect.addEventListener("change", function () {
            const floor = floorSelect.value;
            fetchRooms(floor);
        });
    
        // Fetch rooms based on selected floor
        function fetchRooms(floor) {
            fetch("/get_rooms", {
                method: "POST",
                body: JSON.stringify({ floor: floor }),
                headers: {
                    "Content-Type": "application/json",
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    roomSelect.innerHTML = "";
                    data.rooms.forEach((room) => {
                        const option = document.createElement("option");
                        option.value = room;
                        option.text = "Room " + room;
                        roomSelect.appendChild(option);
                    });
                });
        }
    
        // Check availability button click event
        checkAvailabilityBtn.addEventListener("click", function () {
            const floor = floorSelect.value;
            const room = roomSelect.value;
            checkAvailability(floor, room);
        });
    
        // Book room button click event
        bookRoomBtn.addEventListener("click", function () {
            const floor = floorSelect.value;
            const room = roomSelect.value;
            const time_from = timeFromInput.value;
            const time_to = timeToInput.value;
            bookRoom(floor, room, time_from, time_to);
        });
    
        // Function to check room availability
        function checkAvailability(floor, room) {
            fetch("/check_availability", {
                method: "POST",
                body: new URLSearchParams({ floor: floor, room: room }),
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    statusMessage.textContent = data.status;
                    if (data.status === "Occupied") {
                        statusMessage.textContent += " (Booked from " + data.time_from + " to " + data.time_to + ")";
                    }
                });
        }
    
        // Function to book a room
        function bookRoom(floor, room, time_from, time_to) {
            fetch("/book_room", {
                method: "POST",
                body: new URLSearchParams({ floor: floor, room: room, time_from: time_from, time_to: time_to }),
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    statusMessage.textContent = data.status + " (Booked from " + data.time_from + " to " + data.time_to + ")";
                });
        }
    });
    </script>
</body>
</html>
